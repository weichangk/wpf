### 模板
在WPF中，通过引入模板(Template)微软将数据和算法的“内容”与“形式"解耦了。WPF中的Template分为两大类：ControlTemplate是算法内容的表现形式，一个控件怎样组织其内部结构才能让它更符合业务逻辑、让用户操作起来更舒服就是由它来控制的。它决定了控件“长成什么样子”，并让程序员有机会在控件原有的内部逻辑基础上扩展自己的逻辑。DataTemplate是数据内容的表现形式，一条数据显示成什么样子，是简单的文本还是直观的图形动画就由它来决定。可以理解为, Template就是“外衣”，ControlTemplate是控件的外衣, DataTemplate是数据的外衣。有了Template，使得WPF中的控件不再具有固定的形象，仅仅是算法内容或数据内容的载体。可以把控件理解为一组操作逻辑穿上了一套衣服，换套衣服它就能变成另外一个模样。

#### 数据的外衣DataTemplate
一样的内容可以用不同的形式来展现，软件设计称之为“数据-视图” (Data-View)模式。以往的开发技术如MFC、 Windows Forms、 ASPNET等视图要靠UserControl来实现, WPF不但支持UserControl还支持用DataTemplate为数据形成视图。从UserControl升级到DataTemplate一般就是复制、粘贴一下再改几个字符。使用UserControl实现“数据-视图” (Data-View)模式依赖于事件驱动，“把wpf当作winform来用”。应该使用wpf的数据驱动功能。显然，事件驱动是控件和控件之间沟通或者说是形式与形式之间的沟通，数据驱动则是数据与控件之间的沟通、是内容决定形式。使用DataTemplate就可以很方便地把事件驱动模式升级为数据驱动模式。

- ContentControl的ContentTemplate属性，相当于给ContentControl的内容穿衣服。
- ItemsControl的ItemTemplate属性，相当于给ItemsControl的数据条目穿衣服。
- GridViewColumn的CellTemplate属性，相当于给GridViewColumn单元格里的数据穿衣服。


#### 控件的外衣ControlTemplate
实际项目中, ControlTemplate主要有两大用武之地
- 通过更换ControlTemplate改变控件外观，使之具有更优的用户使用体验及外观。使得换肤更灵活。
- 借助ControlTemplate，程序员与设计师可以并行工作，程序员可以先用WPF标准控件进行编程，等设计师的工作完成后，只需把新的ControlTemplate应用到程序中就可以了。


#### DataTemplate与ControlTemplate的关系和应用
控件只是个数据和行为的载体，是个抽象的概念，至于它本身会长成什么样子(控件内部结构)，它的数据会长成什么样子(数据显示结构)都是靠Template生成的。决定控件外观的是ControlTemplate，决定数据外观的是DataTemplate。

凡是Template，最终都是要作用在控件上的，这个控件就是Template的目标控件，也叫模板化控件(Templated Control)。DataTemplate给人的感觉的确是施加在了数据对象上，但施加在数据对象上生成的一组控件总得有个载体吧，这个载体一般是落实在一个ContentPresenter对象上。ContentPresenter类只有ContentTemplate属性、没有Template属性，这就证明了承载由DataTemplate生成的一组控件是它的专门用途。

由ControlTemplate生成的控件树其树根就是ControlTemplate的目标控件，此模板化控件的Template属性值就是这个ControlTemplate实例。与之相仿，由DataTemplate生成的控件树其树根是一个ContentPresenter控件，此模板化控件的ContentTemplate属性值就是这个DataTemplate实例。因为ContentPresenter控件是ControlTemplate控件树上的一个结点，所以DataTemplate控件树是ControlTemplate控件树的一棵子树。

为Template设置其应用目标有两种方法，一种是逐个设置控件的Template/ContentTemplate/ItemsTemplate/CellTemplate等属性，不想应用Template的控件不设置。另一种是整体应用，即把Template应用在某个类型的控件或数据上。把ControlTemplate应用在所有目标上需要借助Style来实现，但Style不能标记x:Key。

把DataTemplate应用在某个数据类型上的方法是设置DataTemplate的DataType属性，并且DataTemplate作为资源时也不能带有x:Key标记。此时DataTemplate会自动加载到所有Unit类型对象上，通过绑定Unit类型对象就可以得到应用在Unit类型对象上的DataTemplate外衣。

把DataTemplate应用在某个数据类型时，很多时候数据是以XML形式存储的，使用XmIDataProvider作为数据源。DataTemplate很智能，具有直接把XML数据结点当作目标对象的功能，XML数据中的元素名(标签名)可以作为DataType，元素的子结点和Attribute可以使用XPath来访问。XML最大的优势是可以方便地表示带有层级的数据，WPF中TreeView和Menultem控件用来显示层级数据。能够帮助层级控件显示层级数据的模板是HierarchicalDataTemplate。拥有嵌套结构的控件，如Menu控件绑定XML只需要一个HierarchicalDataTemplate就可以了。

#### 访问DataTemplate与ControlTemplate内部的控件
如果UI元素树上有个x:Name="TexiBox1"的控件，某个控件内部也有一个由Template生成的x:Name="TextBox1"的控件，它们并不冲突, Logicaltree不会看到控件内部的细节，Template控件内部元素也不去理会控件外面有什么。

由ControlTemplate或DataTemplate生成的控件都是“由Template生成的控件"。ControlTemplate和DataTemplate两个类均派生自FrameworkTemplate类，这个类有个名为FindName的方法供我们检索其内部控件。也就是只要能拿到Template，找到其内部控件就不成问题。


